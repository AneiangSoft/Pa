<p align="center">
    <img src="assets/logo.png" alt="Aneiang.Pa" width="600" style="vertical-align:middle;border-radius:8px;">
</p>

ä¸­æ–‡ | [English](README.en.md)

[![NuGet](https://img.shields.io/nuget/v/Aneiang.Pa.svg?style=flat-square&logo=nuget)](https://www.nuget.org/packages/Aneiang.Pa)
[![NuGet Downloads](https://img.shields.io/nuget/dt/Aneiang.Pa.svg?style=flat-square&logo=nuget)](https://www.nuget.org/packages/Aneiang.Pa)
[![Target](https://img.shields.io/badge/target-netstandard2.1-blue?style=flat-square)](#)
[![Status](https://img.shields.io/badge/status-active-success?style=flat-square)](#)
![GitHub Repo stars](https://img.shields.io/github/stars/AneiangSoft/Aneiang.Pa)


ä¸€ä¸ªåŸºäº .NET å¼€ç®±å³ç”¨çš„çˆ¬è™«åº“ï¼Œä½¿ç”¨å¤æ‚åº¦æä½ã€‚é¡¹ç›®å°†çˆ¬è™«åˆ†ä¸ºä¸¤å¤§ç±»ï¼š`News`ï¼ˆçƒ­æ¦œï¼‰å’Œ `Sectors`ï¼ˆç‰¹å®šé¢†åŸŸï¼‰ã€‚

- **çƒ­æ¦œ**ï¼šé¢„è®¾äº†å¯¹å¤šä¸ªä¸»æµå¹³å°çƒ­æ¦œçš„çˆ¬å–æ”¯æŒï¼ŒåŒ…æ‹¬å¾®åšã€çŸ¥ä¹ã€B ç«™ã€ç™¾åº¦ã€æŠ–éŸ³ã€è™æ‰‘ã€å¤´æ¡ã€è…¾è®¯ã€æ˜é‡‘ã€æ¾æ¹ƒã€å‡¤å‡°ç½‘ã€è±†ç“£ã€CSDNã€åšå®¢å›­ç­‰ã€‚
- **ç‰¹å®šé¢†åŸŸ**ï¼šæä¾›æ›´çµæ´»çš„çˆ¬è™«ï¼Œç›®å‰åŒ…æ‹¬ `Dynamic`ï¼ˆåŠ¨æ€æ•°æ®é›†çˆ¬å–ï¼‰å’Œ `Lottery`ï¼ˆå½©ç¥¨æ•°æ®çˆ¬å–ï¼‰ã€‚

é¡¹ç›®å®Œå…¨å¼€æºï¼Œåç»­å°†æŒç»­å¢åŠ æ›´å¤šå¹³å°å’Œæ•°æ®ç±»å‹çš„æ”¯æŒã€‚

**âš ï¸ æŠ“å–é—´éš”å»ºè®®æ§åˆ¶åœ¨äº”åˆ†é’Ÿä»¥ä¸Šï¼Œé¿å…é¢‘ç¹æŠ“å–å¯¼è‡´ IP è¢«å°ç¦**

**âš ï¸ çˆ¬å–çš„æ•°æ®ä»…é™ç”¨äºä¸ªäººå­¦ä¹ ã€ç ”ç©¶æˆ–å…¬ç›Šç›®çš„ã€‚ä¸å¾—ç”¨äºå•†ä¸šå”®å–ã€æ”»å‡»ä»–äººæˆ–ä»»ä½•éæ³•æ´»åŠ¨ï¼Œå¦åˆ™éœ€è‡ªè¡Œæ‰¿æ‹…æ³•å¾‹è´£ä»»ã€‚**

- Githubåœ°å€ï¼š[https://github.com/AneiangSoft/Aneiang.Pa](https://github.com/AneiangSoft/Aneiang.Pa)
- Giteeåœ°å€ï¼ˆåŒæ­¥æ›´æ–°ï¼‰ï¼š[https://gitee.com/aneiangsoft/Aneiang.Pa](https://gitee.com/aneiangsoft/Aneiang.Pa)
- çƒ­ç‚¹æ–°é—»åœ¨çº¿Demoï¼š[https://news.aneiang.com](https://news.aneiang.com)

## æ¶æ„è°ƒæ•´
ä¸ºäº†æ›´å¥½åœ°ç»„ç»‡å’Œæ‰©å±•åŠŸèƒ½ï¼Œé¡¹ç›®æ¶æ„å·²è¿›è¡Œè°ƒæ•´ï¼š
- `src/News`: å­˜æ”¾æ‰€æœ‰æ–°é—»çƒ­æ¦œç›¸å…³çš„çˆ¬è™«é¡¹ç›®ã€‚
- `src/Sectors`: å­˜æ”¾ç‰¹å®šé¢†åŸŸçš„çˆ¬è™«é¡¹ç›®ï¼Œå¦‚åŠ¨æ€çˆ¬è™«å’Œå½©ç¥¨çˆ¬è™«ã€‚
- `src/Core`: å­˜æ”¾æ ¸å¿ƒæ¥å£ã€æ¨¡å‹å’Œå…¬å…±æœåŠ¡ã€‚

## å®‰è£…ï¼ˆNuGetï¼‰
é¡¹ç›®æä¾›ä¸¤ç§èšåˆåŒ…å’ŒæŒ‰éœ€å¼•ç”¨çš„å•ä¸ªåŠŸèƒ½åŒ…ï¼Œå¼€å‘è€…å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ã€‚

### èšåˆåŒ…
1.  **å…¨å±€èšåˆåŒ…** (`Aneiang.Pa`)ï¼šåŒ…å«æ‰€æœ‰å·²å®ç°çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–°é—»çƒ­æ¦œã€ç‰¹å®šé¢†åŸŸçˆ¬è™«ç­‰ã€‚
    ```bash
    dotnet add package Aneiang.Pa
    ```
2.  **çƒ­æ¦œèšåˆåŒ…** (`Aneiang.Pa.News`)ï¼šä»…åŒ…å«æ‰€æœ‰æ–°é—»çƒ­æ¦œç›¸å…³çš„çˆ¬è™«ã€‚
    ```bash
    dotnet add package Aneiang.Pa.News
    ```

### å•ä¸ªåŠŸèƒ½åŒ…
å¦‚æœåªéœ€è¦ç‰¹å®šå¹³å°æˆ–åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰éœ€å¼•ç”¨å•ä¸ªåŒ…ä»¥å‡å°ä¾èµ–ä½“ç§¯ã€‚
```bash
# ç¤ºä¾‹ï¼šä»…å¼•ç”¨ç™¾åº¦çƒ­æ¦œçˆ¬è™«
dotnet add package Aneiang.Pa.BaiDu
```

### å·²å‘å¸ƒåŒ…
| Package | è¯´æ˜ |
| --- | --- |
| **Aneiang.Pa** | **èšåˆåŒ…ï¼ŒåŒ…å«å…¨éƒ¨å¹³å°å®ç°** |
| Aneiang.Pa.Core | æ ¸å¿ƒæ¥å£ä¸æ¨¡å‹ã€ä»£ç†æ± åŠŸèƒ½ |
| Aneiang.Pa.AspNetCore | ASP.NET Core Web API æ‰©å±•ï¼ˆæä¾› RESTful API æ§åˆ¶å™¨ï¼‰ |
| **--- News (çƒ­æ¦œ) ---** | **---** |
| Aneiang.Pa.News | çƒ­æ¦œèšåˆåŒ…ï¼ŒåŒ…å«ä»¥ä¸‹æ‰€æœ‰æ–°é—»å¹³å° |
| Aneiang.Pa.BaiDu | ç™¾åº¦çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.Bilibili | B ç«™çƒ­æœçˆ¬è™« |
| Aneiang.Pa.WeiBo | å¾®åšçƒ­æœçˆ¬è™« |
| Aneiang.Pa.ZhiHu | çŸ¥ä¹çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.DouYin | æŠ–éŸ³çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.HuPu | è™æ‰‘çƒ­å¸–/çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.TouTiao | ä»Šæ—¥å¤´æ¡çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.Tencent | è…¾è®¯çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.JueJin | æ˜é‡‘çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.ThePaper | æ¾æ¹ƒçƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.DouBan | è±†ç“£çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.IFeng | å‡¤å‡°ç½‘çƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.Csdn | CSDNçƒ­æ¦œçˆ¬è™« |
| Aneiang.Pa.CnBlog | åšå®¢å›­çƒ­æ¦œçˆ¬è™« |
| **--- Sectors (ç‰¹å®šé¢†åŸŸ) ---** | **---** |
| Aneiang.Pa.Dynamic | åŠ¨æ€çˆ¬è™«ï¼Œå¯çˆ¬å–ä»»æ„ç½‘ç«™çš„æ•°æ®é›†åˆ |
| Aneiang.Pa.Lottery | å½©ç¥¨æ•°æ®çˆ¬è™« |

## å¿«é€Ÿå¼€å§‹ï¼ˆæœ¬åœ° Demoï¼‰
1) è¿˜åŸ & æ„å»º
```bash
dotnet restore
dotnet build test/Aneiang.Pa.Demo/Aneiang.Pa.Demo.csproj
```
2) è¿è¡Œ Demoï¼ˆé»˜è®¤æŠ“å–ç™¾åº¦çƒ­æ¦œï¼Œå¯ä¿®æ”¹ `ScraperSource`ï¼‰
```bash
dotnet run --project test/Aneiang.Pa.Demo
```
è¿è¡Œåï¼Œå°†åœ¨æ§åˆ¶å°çœ‹åˆ°æŠ“å–åˆ°çš„ç™¾åº¦çƒ­æ¦œæ•°æ®ã€‚

## åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨

### 1. æ³¨å†ŒæœåŠ¡

æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å…¨å±€æ³¨å†Œæ–¹æ³•ï¼Œä¸€é”®æ·»åŠ æ‰€æœ‰çˆ¬è™«åŠŸèƒ½ã€‚

```csharp
// æ³¨å†Œæ‰€æœ‰çˆ¬è™«ï¼ˆæ¨èï¼‰
services.AddPaScraper();
```

å¦‚æœä½ åªéœ€è¦ç‰¹å®šåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥æŒ‰éœ€æ³¨å†Œï¼š

```csharp
// ä»…æ³¨å†Œçƒ­æ¦œçˆ¬è™«
services.AddNewsScraper();

// ä»…æ³¨å†Œå½©ç¥¨çˆ¬è™«
services.AddLotteryScraper();

// ä»…æ³¨å†ŒåŠ¨æ€çˆ¬è™«
services.AddDynamicScraper();

// ä»…æ³¨å†Œç™¾åº¦çƒ­æ¦œçˆ¬è™«
services.AddBaiDuScraper();
```

### 2. ä½¿ç”¨çˆ¬è™«

æ³¨å†ŒæœåŠ¡åï¼Œä½ å¯ä»¥ä»ä¾èµ–æ³¨å…¥å®¹å™¨ä¸­è·å–ç›¸åº”çš„æœåŠ¡å®ä¾‹ã€‚

**è·å–çƒ­æ¦œæ•°æ®**

```csharp
// é€šè¿‡å·¥å‚æ¨¡å¼è·å–
var factory = scope.ServiceProvider.GetRequiredService<INewsScraperFactory>();
var scraper = factory.GetScraper(ScraperSource.BaiDu);
var result = await scraper.GetNewsAsync();

// æˆ–ç›´æ¥æ³¨å…¥å•ä¸ªçˆ¬è™«
var baiduScraper = scope.ServiceProvider.GetRequiredService<IBaiDuNewScraper>();
var baiduResult = await baiduScraper.GetNewsAsync();
```

**è·å–å½©ç¥¨æ•°æ®**

```csharp
var lotteryScraper = scope.ServiceProvider.GetRequiredService<ILotteryScraper>();
var ssqResult = await lotteryScraper.GetLotteryDataAsync(LotteryType.SSQ); // ç¦åˆ©å½©ç¥¨
var dltResult = await lotteryScraper.GetLotteryDataAsync(LotteryType.DLT); // ä½“è‚²å½©ç¥¨
```

**ä½¿ç”¨åŠ¨æ€çˆ¬è™«**

```csharp
var dynamicScraper = scope.ServiceProvider.GetRequiredService<IDynamicScraper>();
// çˆ¬å–åšå®¢å›­çƒ­é—¨æ–‡ç« ï¼ˆéœ€è¦å…ˆå®šä¹‰ CnBlogOriginalResult æ¨¡å‹ï¼‰
var cnblogsPosts = await dynamicScraper.DatasetScraper<CnBlogOriginalResult>("https://www.cnblogs.com/pick");
```

## ğŸŒ ä»£ç†æ± åŠŸèƒ½ï¼ˆProxy Poolï¼‰

**æ”¯æŒé…ç½®å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè‡ªåŠ¨è½®è¯¢æˆ–éšæœºé€‰æ‹©ä»£ç†è¿›è¡Œè¯·æ±‚ï¼Œæœ‰æ•ˆé¿å… IP è¢«å°ç¦ã€‚**

### åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒå¤šä¸ªä»£ç†æœåŠ¡å™¨é…ç½®
- âœ… æ”¯æŒä¸¤ç§é€‰æ‹©ç­–ç•¥ï¼šè½®è¯¢ï¼ˆRoundRobinï¼‰å’Œéšæœºï¼ˆRandomï¼‰
- âœ… æ”¯æŒå¸¦è®¤è¯çš„ä»£ç†ï¼ˆ`http://user:password@host:port`ï¼‰
- âœ… å¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ä»£ç é…ç½®
- âœ… æœªå¯ç”¨æ—¶è‡ªåŠ¨é€€åŒ–ä¸ºæ™®é€š HttpClient

### ä½¿ç”¨æ–¹å¼

#### æ–¹å¼1ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

åœ¨ `appsettings.json` ä¸­é…ç½®ï¼š
```json
{
  "Scraper": {
    "ProxyPool": {
      "Enabled": true,
      "Strategy": "RoundRobin",
      "Proxies": [
        "http://127.0.0.1:7890",
        "http://user:password@proxy.example.com:8080",
        "http://192.168.1.100:3128"
      ]
    }
  }
}
```

åœ¨ä»£ç ä¸­æ³¨å†Œï¼š
```csharp
using Aneiang.Pa.Core.Proxy;

var builder = Host.CreateDefaultBuilder(args)
    .ConfigureServices((context, services) =>
    {
        // æ³¨å†Œå¸¦ä»£ç†æ± æ”¯æŒçš„é»˜è®¤ HttpClient
        services.AddPaDefaultHttpClientWithProxy(
            proxyConfiguration: context.Configuration.GetSection("Scraper:ProxyPool"));
        
        // æ³¨å†Œçˆ¬è™«æœåŠ¡ï¼ˆä¼šè‡ªåŠ¨ä½¿ç”¨é…ç½®çš„ HttpClientï¼‰
        services.AddNewsScraper(context.Configuration);
    })
    .Build();
```

#### æ–¹å¼2ï¼šé€šè¿‡ä»£ç é…ç½®

```csharp
using Aneiang.Pa.Core.Proxy;

services.AddPaDefaultHttpClientWithProxy(
    proxyConfigure: options =>
    {
        options.Enabled = true;
        options.Strategy = ProxySelectionStrategy.RoundRobin; // æˆ– Random
        options.Proxies = new List<string>
        {
            "http://127.0.0.1:7890",
            "http://user:password@proxy.example.com:8080",
            "http://192.168.1.100:3128"
        };
    });

services.AddNewsScraper();
```

#### ä»…æ³¨å†Œä»£ç†æ± æœåŠ¡ï¼ˆä¸æ³¨å†Œ HttpClientï¼‰

å¦‚æœåªéœ€è¦ä»£ç†æ± æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```csharp
// ä»…æ³¨å†Œä»£ç†æ± æœåŠ¡
services.AddPaProxyPool(
    configuration: context.Configuration.GetSection("Scraper:ProxyPool"));

// æˆ–é€šè¿‡ä»£ç é…ç½®
services.AddPaProxyPool(
    configure: options =>
    {
        options.Enabled = true;
        options.Strategy = ProxySelectionStrategy.Random;
        options.Proxies = new List<string> { "http://127.0.0.1:7890" };
    });

// ç„¶åæ³¨å…¥ IProxyPool ä½¿ç”¨
var proxyPool = serviceProvider.GetRequiredService<IProxyPool>();
var proxyUri = proxyPool.GetNextProxy();
```

### ä»£ç†é€‰æ‹©ç­–ç•¥

- **RoundRobinï¼ˆè½®è¯¢ï¼‰**ï¼šæŒ‰é¡ºåºä¾æ¬¡ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼Œç¡®ä¿è´Ÿè½½å‡è¡¡
- **Randomï¼ˆéšæœºï¼‰**ï¼šæ¯æ¬¡éšæœºé€‰æ‹©ä¸€ä¸ªä»£ç†æœåŠ¡å™¨

### ä»£ç†åœ°å€æ ¼å¼

æ”¯æŒä»¥ä¸‹æ ¼å¼çš„ä»£ç†åœ°å€ï¼š
- `http://host:port` - HTTP ä»£ç†ï¼ˆæ— è®¤è¯ï¼‰
- `http://user:password@host:port` - HTTP ä»£ç†ï¼ˆå¸¦è®¤è¯ï¼‰
- `https://host:port` - HTTPS ä»£ç†

### æ³¨æ„äº‹é¡¹

1. **å¯ç”¨æ£€æŸ¥**ï¼šå¦‚æœ `Enabled = true` ä½†æœªé…ç½®ä»£ç†åˆ—è¡¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸
2. **HttpClient åç§°**ï¼šé»˜è®¤ HttpClient åç§°ä¸º `Aneiang.Pa.DefaultHttpClient`ï¼Œçˆ¬è™«ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥ HttpClient
3. **ä»£ç†ä¼˜å…ˆçº§**ï¼šå¦‚æœåœ¨ `AddNewsScraper` ä¹‹å‰è°ƒç”¨ `AddPaDefaultHttpClientWithProxy`ï¼Œçˆ¬è™«ä¼šä½¿ç”¨é…ç½®çš„ä»£ç†æ± 
4. **æœªå¯ç”¨æ—¶**ï¼šå½“ `Enabled = false` æˆ–ä»£ç†åˆ—è¡¨ä¸ºç©ºæ—¶ï¼Œä¼šè‡ªåŠ¨é€€åŒ–ä¸ºæ™®é€š HttpClientï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨

## ğŸš€ ASP.NET Core Web API é›†æˆï¼ˆAneiang.Pa.AspNetCoreï¼‰

**æä¾›å¼€ç®±å³ç”¨çš„ Web API æ§åˆ¶å™¨ï¼Œæ”¯æŒ RESTful API è°ƒç”¨å’Œå¯é€‰çš„æˆæƒåŠŸèƒ½ã€‚**

### å®‰è£… ASP.NET Core æ‰©å±•åŒ…
```bash
dotnet add package Aneiang.Pa.AspNetCore
```

### å¿«é€Ÿå¼€å§‹

#### 1. æ³¨å†ŒæœåŠ¡
```csharp
using Aneiang.Pa.Extensions;
using Aneiang.Pa.AspNetCore.Extensions;

var builder = WebApplication.CreateBuilder(args);

// æ³¨å†Œæ–°é—»çˆ¬è™«æœåŠ¡
builder.Services.AddNewsScraper(builder.Configuration);

// æ·»åŠ çˆ¬è™«æ§åˆ¶å™¨æ”¯æŒ
builder.Services.AddScraperController(options =>
{
    options.RoutePrefix = "api/scraper";      // è·¯ç”±å‰ç¼€ï¼Œé»˜è®¤ "api/scraper"
    options.UseLowercaseInRoute = true;       // è·¯ç”±ä½¿ç”¨å°å†™
    options.EnableResponseCaching = true;     // å¯ç”¨å“åº”ç¼“å­˜
    options.CacheDurationSeconds = 300;       // ç¼“å­˜æ—¶é•¿ï¼ˆç§’ï¼‰
});

var app = builder.Build();

// å¯ç”¨å“åº”ç¼“å­˜ä¸­é—´ä»¶ï¼ˆå¿…é¡»åœ¨ä½¿ç”¨ç¼“å­˜çš„ç«¯ç‚¹ä¹‹å‰è°ƒç”¨ï¼‰
app.UseResponseCaching();

app.MapControllers();
app.Run();
```

#### 2. API ç«¯ç‚¹

æ§åˆ¶å™¨æä¾›ä»¥ä¸‹ RESTful API ç«¯ç‚¹ï¼š

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
| --- | --- | --- | --- |
| `/api/scraper/{source}` | GET | è·å–æŒ‡å®šå¹³å°çš„æ–°é—» | `/api/scraper/BaiDu` |
| `/api/scraper/available-sources` | GET | è·å–æ‰€æœ‰æ”¯æŒçš„çˆ¬è™«æºåˆ—è¡¨ | `/api/scraper/available-sources` |
| `/api/scraper/health` | GET | æ£€æŸ¥æ‰€æœ‰çˆ¬è™«çš„å¥åº·çŠ¶æ€ | `/api/scraper/health?timeoutMs=5000` |
| `/api/scraper/{source}/health` | GET | æ£€æŸ¥æŒ‡å®šçˆ¬è™«çš„å¥åº·çŠ¶æ€ | `/api/scraper/BaiDu/health?timeoutMs=5000` |

**æ”¯æŒçš„çˆ¬è™«æº**ï¼š`BaiDu`ã€`Bilibili`ã€`WeiBo`ã€`ZhiHu`ã€`DouYin`ã€`HuPu`ã€`TouTiao`ã€`Tencent`ã€`JueJin`ã€`ThePaper`ã€`DouBan`ã€`IFeng`ã€`Csdn`ã€`CnBlog`ï¼ˆæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿï¼‰

#### 3. æˆæƒé…ç½®ï¼ˆå¯é€‰ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼ŒæˆæƒåŠŸèƒ½æ˜¯**æœªå¯ç”¨**çš„ï¼ˆ`Enabled = false`ï¼‰ï¼Œæ‰€æœ‰ API ç«¯ç‚¹éƒ½å¯ä»¥å…¬å¼€è®¿é—®ã€‚å¦‚æœéœ€è¦ä¿æŠ¤ APIï¼Œå¯ä»¥é…ç½®æˆæƒã€‚

**æ–¹å¼1ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰**

åœ¨ `appsettings.json` ä¸­é…ç½®ï¼š
```json
{
  "Scraper": {
    "Authorization": {
      "Enabled": true,
      "Scheme": "ApiKey",
      "ApiKeys": [
        "your-api-key-1",
        "your-api-key-2"
      ],
      "ApiKeyHeaderName": "X-API-Key",
      "ApiKeyQueryParameterName": "apiKey",
      "ExcludedRoutes": [
        "/api/scraper/health",
        "/api/scraper/available-sources"
      ],
      "UnauthorizedMessage": "æœªæˆæƒè®¿é—®"
    }
  }
}
```

ç„¶ååœ¨ä»£ç ä¸­å¯ç”¨ï¼š
```csharp
builder.Services.ConfigureAuthorization(builder.Configuration);
```

**æ–¹å¼2ï¼šé€šè¿‡ä»£ç é…ç½®**

```csharp
builder.Services.ConfigureAuthorization(options =>
{
    // å¯ç”¨æˆæƒ
    options.Enabled = true;
    
    // è®¾ç½®æˆæƒæ–¹å¼ï¼šApiKeyã€Custom æˆ– Combined
    options.Scheme = AuthorizationScheme.ApiKey;
    
    // é…ç½® API Key åˆ—è¡¨
    options.ApiKeys = new List<string>
    {
        "your-api-key-1",
        "your-api-key-2"
    };
    
    // è®¾ç½® API Key è¯·æ±‚å¤´åç§°ï¼ˆé»˜è®¤ï¼šX-API-Keyï¼‰
    options.ApiKeyHeaderName = "X-API-Key";
    
    // è®¾ç½® API Key æŸ¥è¯¢å‚æ•°åç§°ï¼ˆå¯é€‰ï¼‰
    options.ApiKeyQueryParameterName = "apiKey";
    
    // æ’é™¤ä¸éœ€è¦æˆæƒçš„è·¯ç”±ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
    options.ExcludedRoutes = new List<string>
    {
        "/api/scraper/health",
        "/api/scraper/*/health"  // é€šé…ç¬¦åŒ¹é…
    };
    
    // è‡ªå®šä¹‰æœªæˆæƒé”™è¯¯æ¶ˆæ¯
    options.UnauthorizedMessage = "æœªæˆæƒè®¿é—®";
});
```

**æˆæƒæ–¹å¼è¯´æ˜**ï¼š

- **ApiKey**ï¼šé€šè¿‡è¯·æ±‚å¤´ `X-API-Key` æˆ–æŸ¥è¯¢å‚æ•° `apiKey` ä¼ é€’ API Key è¿›è¡ŒéªŒè¯
- **Custom**ï¼šä½¿ç”¨è‡ªå®šä¹‰æˆæƒéªŒè¯å‡½æ•°
- **Combined**ï¼šAPI Key æˆ–è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼Œæ»¡è¶³ä»»ä¸€å³å¯

**è‡ªå®šä¹‰æˆæƒç¤ºä¾‹**ï¼š
```csharp
builder.Services.ConfigureAuthorization(options =>
{
    options.Enabled = true;
    options.Scheme = AuthorizationScheme.Custom;
    
    // è‡ªå®šä¹‰æˆæƒéªŒè¯å‡½æ•°
    options.CustomAuthorizationFunc = (httpContext) =>
    {
        var authHeader = httpContext.Request.Headers["Authorization"].FirstOrDefault();
        if (authHeader?.StartsWith("Bearer ", StringComparison.OrdinalIgnoreCase) == true)
        {            var token = authHeader.Substring("Bearer ".Length).Trim();
            // éªŒè¯ tokenï¼ˆä¾‹å¦‚ï¼šéªŒè¯ JWTã€æŸ¥è¯¢æ•°æ®åº“ç­‰ï¼‰
            if (token == "valid-token")
            {
                // å¯ä»¥è¿”å› ClaimsPrincipal
                var claims = new[]
                {
                    new Claim(ClaimTypes.Name, "user"),
                    new Claim(ClaimTypes.Role, "admin")
                };
                var identity = new ClaimsIdentity(claims, "custom");
                var principal = new ClaimsPrincipal(identity);
                return (true, principal);
            }
        }
        return (false, null);
    };
});
```

**ä½¿ç”¨ API Key è°ƒç”¨ API**ï¼š

é€šè¿‡è¯·æ±‚å¤´ï¼š
```bash
curl -H "X-API-Key: your-api-key-1" https://your-api.com/api/scraper/BaiDu
```

é€šè¿‡æŸ¥è¯¢å‚æ•°ï¼š
```bash
curl https://your-api.com/api/scraper/BaiDu?apiKey=your-api-key-1
```

#### 4. å¥åº·æ£€æŸ¥åŠŸèƒ½

å¥åº·æ£€æŸ¥åŠŸèƒ½éœ€è¦æ³¨å†Œ `IScraperHealthCheckService` æœåŠ¡ã€‚å¦‚æœä½¿ç”¨ `AddNewsScraper()` æ–¹æ³•ï¼Œè¯¥æœåŠ¡ä¼šè‡ªåŠ¨æ³¨å†Œã€‚

å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š
- `GET /api/scraper/health?timeoutMs=5000` - æ£€æŸ¥æ‰€æœ‰çˆ¬è™«çš„å¥åº·çŠ¶æ€
- `GET /api/scraper/{source}/health?timeoutMs=5000` - æ£€æŸ¥æŒ‡å®šçˆ¬è™«çš„å¥åº·çŠ¶æ€

å‚æ•°è¯´æ˜ï¼š
- `timeoutMs`ï¼šè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼ŒèŒƒå›´ 1-60000ï¼Œé»˜è®¤ 5000

#### 5. ç¤ºä¾‹é¡¹ç›®

æŸ¥çœ‹ `test/Aneiang.Pa.ClientDemo` ç›®å½•ä¸‹çš„å®Œæ•´ç¤ºä¾‹ä»£ç ã€‚

## âœ¨ é«˜é˜¶ç”¨æ³• - åŠ¨æ€çˆ¬å–ï¼ˆAneiang.Pa.Dynamicï¼‰

**é™¤äº†åŸºç¡€çš„çƒ­é—¨æ•°æ®çˆ¬å–å¤–ï¼Œè¿˜æä¾›äº†æ›´åŠ çµæ´»ã€è½»é‡ã€ç‹¬ç«‹çš„çˆ¬è™«åº“ - Aneiang.Pa.Dynamicï¼Œå¯ä»¥åšåˆ°çˆ¬å–ä»»æ„ç½‘ç«™çš„æ•°æ®é›†åˆã€‚**

### å¼•å…¥Nuget
```bash
dotnet add package Aneiang.Pa.Dynamic
```
ä½¿ç”¨æ—¶é€šè¿‡å®šä¹‰æ¨¡å‹ç‰¹æ€§æ¥å®ç°ï¼Œä»¥çˆ¬å–[åšå®¢å›­](https://www.cnblogs.com/pick/)çƒ­é—¨æ•°æ®ä¸ºä¾‹ï¼š

```csharp
services.AddDynamicScraper();
```

```csharp
var scraperFactory = scope.ServiceProvider.GetRequiredService<IDynamicScraper>();
var testDataSets = await scraperFactory.DatasetScraper<CnBlogOriginalResult>("https://www.cnblogs.com/pick");

```
é‡ç‚¹åœ¨äºå®šä¹‰CnBlogOriginalResultæ¨¡å‹

```csharp
[HtmlContainer("div", htmlClass: "post-list",htmlId: "post_list", index: 1)]
[HtmlItem("article",htmlClass: "post-item")]
public class CnBlogOriginalResult
{
    [HtmlValue("a",htmlClass: "post-item-title")]
    public string Title { get; set; }

    [HtmlValue(".",attribute: "data-post-id")]
    public string Id { get; set; }

    [HtmlValue("a", htmlClass: "post-item-title",attribute: "href")]
    public string Url { get; set; }

    [HtmlValue(htmlXPath:".//a[@class=\"post-item-author\"]/span")]
    public string AuthorName { get; set; }

    [HtmlValue("a", htmlClass: "post-item-author", attribute: "href")]
    public string AuthorUrl { get; set; }

    [HtmlValue("p", htmlClass: "post-item-summary")]
    public string Desc { get; set; }

    [HtmlValue(htmlXPath: ".//footer[@class=\"post-item-foot\"]/span[1]")]
    public string CreateTime { get; set; }

    [HtmlValue(htmlXPath: ".//footer[@class=\"post-item-foot\"]/a[2]")]
    public string CommentCount { get; set; }

    [HtmlValue(htmlXPath: ".//footer[@class=\"post-item-foot\"]/a[3]")]
    public string LikeCount { get; set; }

    [HtmlValue(htmlXPath: ".//footer[@class=\"post-item-foot\"]/a[4]")]
    public string ReadCount { get; set; }
}
```
çˆ¬å–çš„åšå®¢å›­HTMLéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š
```html
<div id="post_list" class="post-list">
    <article class="post-item" data-post-id="19326078">
        <section class="post-item-body">

            <div class="post-item-text">
                <a class="post-item-title" href="https://www.cnblogs.com/ydswin/p/19326078"
                    target="_blank">Keepalivedè¯¦è§£ï¼šåŸç†ã€ç¼–è¯‘å®‰è£…ä¸é«˜å¯ç”¨é›†ç¾¤é…ç½®</a>
                <p class="post-item-summary">
                    <a href="https://www.cnblogs.com/ydswin" target="_blank">
                        <img src="https://pic.cnblogs.com/face/1307305/20240510180945.png" class="avatar" alt="åšä¸»å¤´åƒ" />
                    </a>
                    åœ¨é«˜å¯ç”¨æ¶æ„ä¸­ï¼Œé¿å…å•ç‚¹æ•…éšœè‡³å…³é‡è¦ã€‚Keepalivedæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜è€Œç”Ÿçš„è½»é‡çº§å·¥å…·ã€‚æœ¬æ–‡å°†æ·±å…¥æµ…å‡ºåœ°ä»‹ç»Keepalivedçš„å·¥ä½œåŸç†ï¼Œå¹¶æä¾›ä»ç¼–è¯‘å®‰è£…åˆ°å®æˆ˜é…ç½®çš„å®Œæ•´æŒ‡å—ã€‚
                    1. Keepalivedç®€ä»‹ä¸å·¥ä½œåŸç† Keepalivedæ˜¯ä¸€ä¸ªåŸºäºVRRPåè®®ï¼ˆè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼‰ å®ç°çš„ ...
                </p>
            </div>
            <footer class="post-item-foot">
                <a href="https://www.cnblogs.com/ydswin" class="post-item-author"
                    target="_blank"><span>dashery</span></a>

                <span class="post-meta-item">
                <span>2025-12-09 13:01</span>
                </span>
                <a class="post-meta-item btn"
                    href="https://www.cnblogs.com/ydswin/p/19326078#commentform" title="è¯„è®º 1">
                    <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg">
                        <use xlink:href="#icon_comment"></use>
                    </svg>
                    <span>1</span>
                </a>
                <a id="digg_control_19326078" title="æ¨è 7" class="post-meta-item btn "
                    href="javascript:void(0)"
                    onclick="DiggPost('ydswin', 19326078, 817406, 1);return false;">
                    <svg width="16" height="16" viewBox="0 0 16 16"
                        xmlns="http://www.w3.org/2000/svg">
                        <use xlink:href="#icon_digg"></use>
                    </svg>
                    <span id="digg_count_19326078">7</span>
                </a>
                <a class="post-meta-item btn" href="https://www.cnblogs.com/ydswin/p/19326078"
                    title="é˜…è¯» 1892">
                    <svg width="16" height="16" viewBox="0 0 16 16"
                        xmlns="http://www.w3.org/2000/svg">
                        <use xlink:href="#icon_views"></use>
                    </svg>
                    <span>1892</span>
                </a>
                <span id="digg_tip_19326078" class="digg-tip" style="color: red"></span>
            </footer>

        </section>
        <figure>
        </figure>
    </article>
    <!-- å¤šä¸ª <article> -->
</div>
```
### ç‰¹æ€§è¯´æ˜

- `HtmlContainerAttribute`ï¼šæ•°æ®é›†å®¹å™¨ç‰¹æ€§ï¼ŒåŒ…å«æ•°æ®é›†æ ‡ç­¾çš„çˆ¶çº§æ ‡ç­¾ï¼Œå¯ä»¥ä¸æ˜¯ç›´æ¥çˆ¶çº§ï¼Œæ”¯æŒé€šè¿‡`id`ã€`class`æŸ¥æ‰¾ï¼Œå½“æ— æ³•é€šè¿‡`id`ã€`class`åˆ¤æ–­å”¯ä¸€çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®`index`è·å–æŒ‡å®šçš„HTMLèŠ‚ç‚¹ã€‚
- `HtmlItemAttribute`ï¼šæ•°æ®é¡¹ç‰¹æ€§ï¼Œæ¯æ¡æ•°æ®å¯¹åº”çš„HTMLæ ‡ç­¾å±æ€§ï¼Œæ”¯æŒé€šè¿‡`id`ã€`class`æŸ¥æ‰¾ï¼Œå½“æ— æ³•é€šè¿‡`id`ã€`class`åˆ¤æ–­å”¯ä¸€çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®`index`è·å–æŒ‡å®šçš„HTMLèŠ‚ç‚¹ã€‚
- `HtmlValueAttribute`ï¼šæ•°æ®å€¼ç‰¹æ€§ï¼Œæ¯æ¡æ•°æ®ï¼Œæ¯ä¸ªå­—æ®µå¯¹åº”çš„HTMLæ ‡ç­¾å±æ€§ï¼Œæ”¯æŒé€šè¿‡`id`ã€`class`æŸ¥æ‰¾ï¼Œå½“æ— æ³•é€šè¿‡`id`ã€`class`åˆ¤æ–­å”¯ä¸€çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®`index`è·å–æŒ‡å®šçš„HTMLèŠ‚ç‚¹ï¼›`htmlAttribute`å­—æ®µæŒ‡å®šä»å“ªä¸ªhtmlç‰¹æ€§ä¸­è·å–å€¼ã€‚

**PS:ä»¥ä¸Šä¸‰ä¸ªç‰¹æ€§éƒ½æ”¯æŒXPathæ£€ç´¢HTMLæ ‡ç­¾ï¼Œ`HTMLXPath`ä¸ä¸ºç©ºæ—¶ï¼Œå…¶ä»–å±æ€§éƒ½ä¸ç”Ÿæ•ˆ**

#### HtmlTagå‚æ•°è§£æ

`HtmlTag` å’Œ `HTMLXPath` åº•å±‚åŸºäº`XPath`è§„åˆ™å¼€å‘ï¼Œæ›´å¤šä¿¡æ¯å¯æŸ¥é˜…`XPath`ç›¸å…³æ–‡æ¡£ã€‚

| é€‰æ‹©å™¨ | åŒ¹é…ç»“æ„ | ç¤ºä¾‹ |
| --- | --- | --- |
| `p/b` | pç›´æ¥åŒ…å«b | `<p><b></b></p>` |
| `p//b` | pçš„ä»»ä½•åä»£ä¸­çš„p | `<p><div><b></b></div></p>` |
| `p/div/b` | a > div > img | `<p><div><b></b></div></p>` |
| `.` | ä»…`HtmlValue`è®¾ç½®ï¼Œè¡¨ç¤ºå–å½“å‰`HtmlItem`çš„HtmlTag|||

### çˆ¬å–ç»“æœæˆªå›¾
![](./assets/ScreenShot_D.png)

## è§„åˆ’ä¸ Roadmap
- âœ… å¾®åšã€çŸ¥ä¹ã€B ç«™ã€ç™¾åº¦ã€æŠ–éŸ³ã€è™æ‰‘ã€å¤´æ¡ã€è…¾è®¯ã€æ˜é‡‘ã€æ¾æ¹ƒã€å‡¤å‡°ç½‘ã€è±†ç“£çƒ­æ¦œ
- âœ… å½©ç¥¨æ•°æ®çˆ¬å–ï¼ˆç¦åˆ©å½©ç¥¨ã€ä½“è‚²å½©ç¥¨ï¼‰
- ğŸš§ è®¡åˆ’ï¼šGitHubã€Steamç­‰æ›´å¤šå¹³å°
- ğŸ§ª è€ƒè™‘ï¼šé™¤çƒ­é—¨æ–°é—»ä¹‹å¤–çš„å…¶ä»–æ•°æ®çˆ¬å–éœ€æ±‚

## è´¡çŒ®
- æ¬¢è¿ PR / Issueï¼Œå°¤å…¶æ˜¯æ–°å¢å¹³å°çˆ¬è™«ã€æ”¹è¿›è§£æä¸å¥å£®æ€§
- æäº¤å‰è¯·ä¿æŒä»£ç é£æ ¼ä¸€è‡´ï¼Œå¹¶é™„å¸¦ç®€è¦è¯´æ˜å’Œå¿…è¦çš„æµ‹è¯•
- å¦‚æœå¸Œæœ›åœ¨ NuGet åŒ…ä¸­å‘å¸ƒä½ æ–°å¢çš„å¹³å°ï¼Œè¯·åœ¨ Issue å…ˆè®¨è®ºæ–¹æ¡ˆ

## è®¸å¯è¯
Aneiang.Pa é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚
